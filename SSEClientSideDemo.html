<!DOCTYPE html>
<html>
  <head>
    <title>SSE Demo</title>
    <meta charset="utf-8" />
  </head>
  <body>
    <div id="app"></div>
    <div id="table">
      <table>
      </table>
    </div>
    <!-- Load React, ReactDOM, and Babel from cdnjs (development UMD builds). -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.development.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
    <script type="text/babel">

      const useState = React.useState;
      const useEffect = React.useEffect;
      
      function App() {
	      const [stocks, setStocks] = useState([]);
	      useEffect(() => {
        const eventSource = new EventSource('http://localhost:31415/stocks');
        eventSource.onmessage = (event) => {
		    const data = JSON.parse(event.data);
		    console.log('data received:', data);
		    setStocks(prev => [data, ...prev.slice(0, 19)]);
        };
        eventSource.onerror = (error) => {
          console.error('SSE connection error:', error);
          eventSource.close();
        };
        return () => eventSource.close(); 
	      }, []);
	      return (
		    <div>
		    <h1>Server-Sent Events Demo (SSE from localhost:31415)</h1>
		    <p>Latest {stocks.length} stocks:</p>
		    <table border="1" style={{borderCollapse: 'collapse', width: '100%'}}>
		      <thead>
		        <tr>
		          <th>Ticker</th>
		          <th>Name</th>
		          <th>Price</th>
		          <th>Volume</th>
		          <th>Time</th>
		        </tr>
		      </thead>
		      <tbody>
		        {stocks.map((stock, idx) => (
		          <tr key={idx}>
		            <td>{stock.ticker}</td>
		            <td>{stock.name}</td>
		            <td>${stock.price}</td>
		            <td>{stock.volume}</td>
		            <td>{new Date(stock.timestamp).toLocaleTimeString()}</td>
		          </tr>
		        ))}
		      </tbody>
		    </table>
		    </div>
	    );
      }
      ReactDOM.render(
        <App />,
	      document.getElementById('app'));
    </script>
  </body>
</html>
